<div class="phase2-container" style="margin: 60px auto 40px auto;
">
    
    <div class="nav-header">
        <button class="icon-btn back-btn" (click)="goHome()" >
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
        </button>
        <div class="header-title">
            <h1>Non-Linear Solver</h1>
            <span class="status-badge">Phase 2</span>
        </div>
    </div>

    <div class="main-grid">
        <div class="input-card glow-border">
            <h2>Configuration</h2>
            
            <div class="form-group equation-group">
                <label>Function f(x)</label>
                <div class="input-wrapper">
                    <span class="prefix">f(x) =</span>
                    <input type="text" [(ngModel)]="functionStr" placeholder="e.g. x^3 - 2*x - 5" class="equation-input">
                </div>
            </div>

            <div class="settings-grid">
                <div class="form-group">
                    <label>Method</label>
                    <select [(ngModel)]="selectedMethod">
                        @for(m of methods; track m.id) {
                            <option [value]="m.id">{{ m.name }}</option>
                        }
                    </select>
                </div>

                <div class="form-group">
                    <label>Precision</label>
                    <input type="number" [(ngModel)]="precision" min="1" max="20">
                </div>

                <div class="form-group">
                    <label>Tolerance</label>
                    <input type="number" [(ngModel)]="tolerance" step="0.00001">
                </div>

                <div class="form-group">
                    <label>Max Iterations</label>
                    <input type="number" [(ngModel)]="maxIterations">
                </div>
            </div>

            <div class="dynamic-inputs animate-fade">
                @if(isBracketMethod) {
                    <div class="bracket-group">
                        <div class="form-group">
                            <label class="text-accent">Lower Bound (Xl)</label>
                            <input type="number" [(ngModel)]="xl" class="highlight-input">
                        </div>
                        <div class="form-group">
                            <label class="text-primary">Upper Bound (Xu)</label>
                            <input type="number" [(ngModel)]="xu" class="highlight-input">
                        </div>
                    </div>
                }

                @if(isOpenMethod) {
                    <div class="form-group">
                        <label class="text-success">Initial Guess (X0)</label>
                        <input type="number" [(ngModel)]="x0" class="highlight-input">
                    </div>
                }

                @if(isSecant) {
                    <div class="bracket-group">
                        <div class="form-group">
                            <label class="text-accent">First Guess (X0)</label>
                            <input type="number" [(ngModel)]="x0" class="highlight-input">
                        </div>
                        <div class="form-group">
                            <label class="text-primary">Second Guess (X1)</label>
                            <input type="number" [(ngModel)]="x1" class="highlight-input">
                        </div>
                    </div>
                }
            </div>

            <div class="action-bar">
                <button class="btn btn-secondary" (click)="plotFunction()" [disabled]="isPlotting || !functionStr">
                    @if(isPlotting) { <span class="loader-sm"></span> }
                    @else { <span>Show Graph</span> }
                </button>
                <button class="btn btn-primary" (click)="solve()" [disabled]="isSolving || !functionStr">
                    @if(isSolving) { <span class="loader-sm"></span> Solving... }
                    @else { <span>CALCULATE ROOT</span> }
                </button>
            </div>
        </div>

        @if(plotImage) {
            <div class="graph-card animate-slide-up">
                <img [src]="'data:image/png;base64,' + plotImage" alt="Function Plot">
            </div>
        }
    </div>

    @if(solutionData) {
        <div id="results-section" class="results-container animate-slide-up">
            
            @if(solutionData.errorMessage) {
                <div class="error-banner">
                    <span class="icon">âš </span>
                    <span>{{ solutionData.errorMessage }}</span>
                </div>
            } @else {
                <div class="success-banner">
                    <div class="root-display">
                        <span class="label">APPROXIMATE ROOT = </span>
                        <span class="value">{{ solutionData.result }}</span>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-label">Time</span>
                        <span class="stat-value">{{ solutionData.executionTime }}s</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Iterations</span>
                        <span class="stat-value">{{ solutionData.TotalIterations }}</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Final Error</span>
                        <span class="stat-value">{{ solutionData.steps[solutionData.steps.length-1].Error | number:'1.1-6' }}</span>
                    </div>
                </div>

                <button class="btn btn-outline full-width" (click)="toggleTable()">
                    {{ showTable ? 'Hide Iterations' : 'View Step-by-Step Table' }}
                </button>

                @if(showTable && solutionData.steps.length > 0) {
                    <div id="steps-table" class="table-wrapper animate-fade">
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>X_Lower</th>
                                    <th>X_Upper</th>
                                    <th>X_Root</th>
                                    <th>f(Xr)</th>
                                    <th>Error</th>
                                </tr>
                            </thead>
                            <tbody>
                                @for(step of solutionData.steps; track step.stepNumber) {
                                    <tr>
                                        <td>{{ step.stepNumber }}</td>
                                        <td>{{ step.X_L ?? '-' }}</td>
                                        <td>{{ step.X_U ?? '-' }}</td>
                                        <td class="text-highlight">{{ step.X_r }}</td>
                                        <td>{{ step.F_Xr }}</td>
                                        <td>{{ step.Error }}</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
            }
        </div>
    }
</div>